<div v-show="currentTab === 'wheel'" class="h-full flex flex-col md:flex-row p-4 max-w-7xl mx-auto w-full gap-4">
  <div class="flex-1 bg-white rounded-lg shadow p-4 flex flex-col items-center justify-start relative bg-pattern min-h-[400px] h-auto pb-4 z-0">
    <h2 class="text-2xl font-bold mb-4 text-orange-600">오늘의 점심은?</h2>
    <div class="relative w-full flex justify-center z-10">
        <canvas id="wheelCanvas" width="400" height="400" class="max-w-full h-auto transition-transform duration-100"></canvas>
    </div>
    <div class="mt-4 w-full flex flex-col items-center justify-center min-h-[40px]">
      <button v-if="!isSpinning && !winner" @click="spinWheel" :disabled="wheelItems.length === 0" :class="['font-bold py-3 px-8 rounded-full shadow-lg transform transition', wheelItems.length === 0 ? 'bg-gray-300 text-gray-500 cursor-not-allowed' : 'bg-orange-500 hover:bg-orange-600 text-white hover:scale-105']">돌리기!</button>
      <div v-else-if="winner" class="text-center animate-bounce-in flex flex-col items-center w-full">
        <p class="text-sm text-gray-900 font-bold mb-1">당첨!</p>
        <p @click="openReadOnlyModal(winner)" :class="['font-bold text-orange-600 my-2 cursor-pointer hover:text-orange-800 hover:scale-105 transition-all underline decoration-orange-500 decoration-2 underline-offset-4 flex items-center gap-2 group', winner.name && winner.name.length < 10 ? 'text-4xl md:text-6xl' : winner.name && winner.name.length < 15 ? 'text-3xl md:text-5xl' : 'text-2xl md:text-4xl']">
          {{ winner.name }}
        </p>
        <div class="flex gap-2 items-center mt-2">
          <button @click="resetWheel" class="text-sm text-gray-900 font-bold border-b-2 border-gray-900 hover:text-orange-600 hover:border-orange-600 transition-colors">다시 하기</button>
        </div>
      </div>
      <div v-else class="text-orange-500 font-bold animate-pulse">두구두구두구...</div>
    </div>
  </div>

  <div class="w-full md:w-96 bg-white rounded-lg shadow p-4 flex flex-col shrink-0 relative">
    <div v-if="isLoading" class="absolute inset-0 bg-white bg-opacity-80 z-20 flex flex-col items-center justify-center rounded-lg">
      <i class="ph ph-spinner animate-spin text-3xl mb-2 text-orange-500"></i>
      <p class="text-xs text-gray-500 animate-pulse">사무실 근처 맛집 정보 불러오는 중...</p>
    </div>
    
    <div class="flex justify-between items-center mb-2 cursor-pointer md:cursor-default" @click="isWheelListExpanded = !isWheelListExpanded">
      <div class="flex items-center justify-between w-full">
        <h3 class="font-bold text-lg">후보 리스트 설정</h3>
        <span v-if="!isWheelListExpanded && windowWidth < 768" class="text-sm text-orange-600 font-bold mr-2">({{ wheelItems.length }}개 선택)</span>
      </div>
      <i class="ph ph-caret-down md:hidden transition-transform duration-300" :class="{'rotate-180': isWheelListExpanded}"></i>
    </div>

    <div v-show="isWheelListExpanded || windowWidth >= 768" class="flex flex-col flex-1 transition-all duration-300">
      <div class="mb-4">
        <p class="text-xs text-gray-500 mb-1">빠른 추가</p>
        <div class="flex flex-wrap gap-2 mb-2">
          <button @click="addAllToWheel" class="text-xs bg-orange-100 hover:bg-orange-200 text-orange-700 px-2 py-1 rounded">전체 추가</button>
          <button @click="clearWheel" class="text-xs bg-red-100 hover:bg-red-200 text-red-700 px-2 py-1 rounded">전체 비우기</button>
        </div>
        <div class="flex flex-wrap gap-2">
          <button @click="addLikedToWheel" class="text-xs bg-red-50 hover:bg-red-100 text-red-600 border border-red-200 px-2 py-1 rounded flex items-center gap-1">
              <i class="ph-fill ph-heart"></i> 찜한 매장
          </button>
          <button @click="addCategoryToWheel('한식')" class="text-xs bg-gray-100 hover:bg-gray-200 active:bg-orange-200 active:text-orange-700 px-2 py-1 rounded">한식</button>
          <button @click="addCategoryToWheel('중식')" class="text-xs bg-gray-100 hover:bg-gray-200 active:bg-orange-200 active:text-orange-700 px-2 py-1 rounded">중식</button>
          <button @click="addCategoryToWheel('일식')" class="text-xs bg-gray-100 hover:bg-gray-200 active:bg-orange-200 active:text-orange-700 px-2 py-1 rounded">일식</button>
          <button @click="addCategoryToWheel('배달')" class="text-xs bg-gray-100 hover:bg-gray-200 active:bg-orange-200 active:text-orange-700 px-2 py-1 rounded">배달만</button>
          <button @click="addCategoryToWheel('밖밥파')" class="text-xs bg-gray-100 hover:bg-gray-200 active:bg-orange-200 active:text-orange-700 px-2 py-1 rounded">밖밥파</button>
          <button @click="addCategoryToWheel('카페')" class="text-xs bg-gray-100 hover:bg-gray-200 active:bg-orange-200 active:text-orange-700 px-2 py-1 rounded">카페</button>
        </div>
      </div>
      
      <div class="relative">
        <input type="text" v-model="wheelSearch" placeholder="매장 이름 검색..." class="w-full border rounded px-3 py-2 text-sm focus:outline-none focus:border-orange-500"/>
        <div v-if="wheelSearch && filteredWheelCandidates.length > 0" class="absolute w-full bg-white border rounded shadow-lg mt-1 max-h-40 overflow-y-auto z-20">
          <div v-for="item in filteredWheelCandidates" :key="item.id" @click="addToWheel(item)" class="px-3 py-2 text-sm hover:bg-orange-50 cursor-pointer flex justify-between">
            <span>{{ item.name }}</span><span class="text-xs text-gray-400">{{ item.category }}</span>
          </div>
        </div>
      </div>
      
      <div class="text-right text-xs text-gray-500 mb-2 mt-1">총 <strong class="text-orange-600">{{ wheelItems.length }}</strong>개의 후보</div>
      
      <div class="flex-1 border rounded bg-gray-50 p-2 min-h-[150px]">
        <div v-if="wheelItems.length === 0" class="text-center text-gray-400 text-sm mt-10">후보 매장을 추가해주세요.</div>
        <transition-group name="list">
          <div v-for="(item, index) in wheelItems" :key="item.id" 
            @mousemove="windowWidth >= 768 ? updateTooltip($event, item) : null" 
            @mouseleave="windowWidth >= 768 ? hideTooltip() : null" 
            @click="openReadOnlyModal(item)"
            class="bg-white p-2 rounded shadow-sm mb-2 flex justify-between items-center text-sm group hover:bg-orange-50 transition cursor-pointer">
            <span class="truncate">{{ item.name }}</span>
            <button @click.stop="removeFromWheel(index)" class="text-gray-300 hover:text-red-500"><i class="ph ph-x"></i></button>
          </div>
        </transition-group>
      </div>
    </div>
  </div>
</div>