# 뉴슐랭 가이드 (Newchelin Guide)

## 1. 개요
- **목적**: 사내 점심/회식 식당 리스트를 관리하고, 사용자 리뷰 및 평점 기반의 정보를 제공하며, 랜덤 뽑기(돌림판)를 통해 점심 메뉴 결정을 돕는 웹 애플리케이션.
- **플랫폼**: Google Workspace (Google Sheets + Google Apps Script)
- **접근 권한 정책**: 사내 구성원 간의 자율적인 정보 공유를 위해 **모든 사용자가 식당 정보를 추가, 수정, 삭제**할 수 있음 (Open Policy).

## 2. 기술 스택
- **프론트엔드**:
    - Framework: **Vue.js 3** (CDN, Composition API)
    - CSS Framework: **Tailwind CSS** (CDN)
    - Icons: **Phosphor Icons** (CDN)
- **백엔드**:
    - Google Apps Script (GAS)
    - Google Sheets (Database)

## 3. 아키텍쳐
### 3.1. 프론트엔드 구조
- **SPA (Single Page Application)**: `currentTab` 상태를 통해 페이지 전환 없이 뷰 교체.
- **반응형 디자인**: 
    - Desktop: 테이블 뷰, 2단 레이아웃(휠).
    - Mobile: 카드 뷰, 스택 레이아웃, 하단 플로팅 버튼.
- **상태 관리**: Vue `ref`, `computed`를 활용한 반응형 데이터 처리.
    - **초기 로딩 데이터 추가**: 앱 실행 시 `User` 정보와 함께 `UserLikedRestaurantIds` (내가 좋아요 누른 식당 ID 목록)를 조회하여 상태로 관리.

### 3.2. 백엔드 (Google Apps Script)
- **모듈 구성**:
    - `WebApi.gs`: `doGet`으로 HTML 서빙, 클라이언트 요청 핸들링.
    - `RestaurantService.gs`: 식당 데이터 CRUD. 
        - `enabled` 컬럼 필터링 (Soft Delete).
        - 날짜 데이터(`created_at`)의 엑셀 Serial Number <-> ISO String 변환 처리.
        - Google Sheets API를 이용한 스마트 칩(Smart Chip) Location 데이터(URL, Text) 추출.
    - `ReviewService.gs`: 리뷰 데이터 CRUD.
        - 리뷰 등록/수정/삭제 시 해당 식당의 평균 별점(`rate`) 자동 재계산 및 `restaurant` 시트 업데이트.
        - 리뷰 수정/삭제 권한: **작성자 본인** 또는 **관리자**(`Config.gs` 등록 계정)만 가능.
    - **[NEW] `LikeService.gs`**: 좋아요(찜) 데이터 처리.
        - `toggleLike(restaurantId)`: 사용자의 좋아요 상태를 토글 (없으면 생성, 있으면 `enabled` 전환).
        - **[Logic]**: 토글 시 `restaurant` 시트의 `like_count` 컬럼 값을 +1 또는 -1 하여 동기화 (정렬 성능 최적화).
        - `getUserLikes()`: 현재 로그인한 사용자가 좋아요(enabled=true)한 식당 ID 목록 반환.
    - `Util.gs`: UUID 생성, 시트 데이터 파싱, 공통 응답 포맷.
    - `Config.gs`: 관리자 이메일 목록 관리 (`ADMIN_EMAILS` - 리뷰 관리 권한용).

### 3.3. 데이터베이스 (Google Sheets)
- **restaurant 시트**: 
    - `id`, `name`, `category`, `tag`, `signature_menu`, `rate`, `location`, `price`, `enabled`, `created_at`, `updated_at`
    - **[NEW] `like_count`**: 좋아요 수 합계 (number) - 정렬 및 표시용 캐시 컬럼.
- **review 시트**: `id`, `restaurant_id`, `rate`, `comment`, `user_name`, `user_email`, `enabled`, `created_at`, `updated_at`
- **[NEW] like 시트**:
    - `id`: 내부 관리용 uuid (text)
    - `restaurant_id`: 식당 아이디 (text)
    - `user_email`: 사용자 이메일 (text)
    - `enabled`: 활성화 여부 (boolean) - 취소 시 false
    - `created_at`: 생성일시 (datetime)
    - `updated_at`: 수정일시 (datetime)

---

## 4. 상세 기능 정의

### 4.1. 공통 레이아웃 (Layout)
- **헤더 (Navigation)**:
    - 로고: 클릭 시 메인 리로드.
    - 탭 메뉴: '식당 리스트', '랜덤 뽑기'.
    - **사용자 프로필**:
        - 로그인한 구글 계정 이니셜 또는 '?' 아이콘.
        - 클릭 시 프로필 모달(랭킹, 이메일, 관리자 여부) 표시.
        - **[NEW] 활동 요약**: 작성한 리뷰 수 옆에 **'누른 좋아요 수'**도 함께 표시.
- **알림 및 로딩**:
    - 커스텀 Alert/Confirm 모달 제공.
    - API 요청 중 전체화면 로딩 인디케이터(Spinner) 표시.

### 4.2. 사용자 랭킹 시스템
- **기준**: 사용자가 작성한 리뷰 수.
- **등급**: 아이언(0) ~ 블랙 다이아몬드(100+).

### 4.3. 식당 리스트 뷰 (Tab: List)
- **검색 및 필터**:
    - 검색바(상호명), 카테고리 필터(멀티), 태그 필터(멀티), 별점 범위 슬라이더(0~5).
    - **[NEW] 좋아요 필터**: '내가 찜한 식당'만 보기 토글 버튼.
    - 검색 결과 수 표시.
- **리스트 출력**:
    - **Desktop**: 그리드 테이블 뷰.
        - 컬럼: 상호명, 카테고리, 평점, **[NEW] 좋아요(하트+숫자)**, 리뷰수, 메뉴, 가격.
        - **[NEW] 정렬**: 상호명, 카테고리, 평점, 리뷰수, **좋아요 수** 정렬 지원.
        - **[NEW] 하트 표시**: 마우스 호버 툴팁 내 하트 아이콘 표시 (View Only).
    - **Mobile**: 카드 뷰 (상호명, 평점, 태그, 최근 리뷰 말풍선).
        - **[NEW] 하트 버튼**: 카드 우측 상단 하트 아이콘 표시 (**Interactive**, 클릭 시 토글).
    - **정렬 (Sorting)**: 
        - Desc/Asc/None 토글 방식.
        - **[NEW] 모바일 정렬 옵션**: '좋아요 많은 순' 추가.
    - **페이지네이션**: 10/30/50/100개 단위 보기.
- **기능 버튼**:
    - **식당 추가**: 우측 하단 플로팅 버튼(FAB). **모든 사용자 접근 가능**.

### 4.4. 식당 상세/추가/수정 (Modal)
- **모드**: `Create`(추가), `Edit`(수정), `View`(상세), `ReadOnly`(당첨 시).
- **식당 정보 관리 (CRUD)**:
    - **권한**: **모든 사용자**가 식당 정보를 **수정** 및 **삭제**할 수 있음.
    - **[NEW] 좋아요 버튼**:
        - **View 모드**: 상호명 옆 하트 아이콘 (**Interactive**).
        - **ReadOnly 모드**: 하트 아이콘 (**View Only**).
        - **Create/Edit 모드**: 미노출.
    - **상호명**: 입력 시 실시간 중복 검사 및 경고.
    - **카테고리**: 기존 데이터 기반 자동완성 제공.
    - **태그**: 키보드 입력(`Space`, `Enter`, `,`)으로 태그 생성 UI.
    - **위치**: 구글 맵 임베드 및 시트 원본 수정 링크 제공(View/Edit 모드 모두).
- **리뷰 기능**:
    - **리뷰 작성**:
        - 별점(1~5), 코멘트 필수.
        - **작성자**: **수동 입력** (기본값 빈칸, 자동완성 없음).
        - 작성 성공 시 리스트 비동기 갱신 및 작성글 하이라이트.
    - **리뷰 리스트**:
        - 최신순 정렬 (날짜 내림차순 -> ID 역순).
        - **관리**: **작성자 본인** 및 **관리자**만 수정/삭제 버튼 노출.

### 4.5. 랜덤 뽑기 (Tab: Wheel)
- **UI 구조**: 좌측 돌림판, 우측 설정 패널.
- **돌림판**:
    - Canvas API 활용 물리 엔진(가속/감속/핀 충돌) 적용.
    - 실시간 리스트 반영 리렌더링.
    - **[NEW] 툴팁**: 후보 리스트 마우스 호버 시 툴팁 내 하트 아이콘 표시 (**View Only**).
- **후보 리스트 설정**:
    - **프리셋**: 전체 추가, 비우기, 카테고리별(한식/중식/일식/카페), 특수(배달만/밖밥파).
    - **[NEW] 좋아요 프리셋**: '좋아요(찜)' 버튼 클릭 시 내가 찜한 식당 일괄 추가.
    - **검색**: 식당명 검색 및 드롭다운 선택으로 개별 추가.
- **진행**:
    - '돌리기' 클릭 시 회전 후 당첨된 식당의 `ReadOnly` 상세 모달 자동 오픈.
    - **[NEW] 당첨 모달**: `ReadOnly` 모달이므로 하트 아이콘은 **View Only**로 표시 (인터랙션 불가).