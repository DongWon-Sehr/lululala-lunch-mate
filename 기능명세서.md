# [v1.4] 뉴슐랭 가이드 (Newchelin Guide) 기능명세서

## 1. 개요
- **목적**: 사내 점심/회식 식당 의사결정 지원 및 정보 공유.
- **플랫폼**: Google Workspace (Google Sheets + Google Apps Script).
- **접근 권한**: 식당 정보(전사 공유/수정), 리뷰(본인 또는 어드민만 수정/삭제).

## 2. 기술 스택
- **FE**: Vue.js 3 (Composition API), Tailwind CSS, Phosphor Icons.
- **BE**: Google Apps Script (GAS).
- **DB**: Google Sheets.

## 3. 아키텍쳐 & 데이터베이스
### 3.1. 프론트엔드 전략
- **SPA 구조**: `List`, `Wheel`, `MyPage` 탭 기반 화면 전환.
- **상태 관리**:
    - **Optimistic UI**: 서버 응답 대기 없이 로컬 상태 선행 업데이트로 빠른 UX 제공.
    - **Caching Strategy**:
        - `restaurants`: 전체 식당 리스트 캐싱.
        - `menuMap`: `{ restaurantId: [menus...] }` 구조로 메모리 캐싱하여 상세 모달 진입 시 로딩 지연 제거.
        - `userLikes`, `myReviewedRestaurantIds`: Set 구조로 필터링 성능 최적화.

### 3.2. 백엔드 (GAS) 로직
- **MenuService**:
    - **Overwrite Strategy**: 메뉴 업데이트 시 '식당ID'로 검색된 기존 행들을 순서대로 덮어쓰기 → 남는 행은 Soft Delete (`enabled=false`) → 부족한 행은 Insert. (Diff 로직 없이 삭제 처리 단순화).
    - **Avg Price**: `가격 > 0`인 메뉴들의 평균값 계산 (0원 서비스 메뉴 제외).
- **RestaurantService**:
    - 식당 저장 시 `MenuService`를 호출하여 메뉴 데이터를 저장.
    - 저장된 메뉴 중 `is_signature=true`인 메뉴의 이름을 추출하여 `restaurant.signature_menu` 컬럼에 업데이트 (리스트 뷰 캐싱용).

### 3.3. 데이터베이스 (Google Sheets)
- **restaurant**:
    - `id`, `name`, `category`, `tag`, `location`, `mapUrl`
    - `signature_menu`: (Text) 리스트 뷰 표시용 캐시 데이터.
    - `price`: (Number) 계산된 평균 가격.
    - `rate`, `like_count`, `reviewCount`, `enabled`, `created_at`, `updated_at`
- **menu**:
    - `id`, `restaurant_id`
    - `name`, `price` (Number)
    - `is_signature`: (Boolean) 시그니처 메뉴 여부.
    - `enabled`, `created_at`, `updated_at`
- **review**: `id`, `restaurant_id`, `rate`, `comment`, `user_name`, `user_email`, `enabled`, `created_at`
- **like**: `id`, `restaurant_id`, `user_email`, `enabled`, `created_at`

---

## 4. 상세 기능 정의

### 4.1. 공통 헤더 (Header)
- **프로필**: 사용자 등급(랭킹), 작성 리뷰 수, 좋아요 수 표시.
- **내 정보**: 클릭 시 **마이페이지** 탭으로 이동.

### 4.2. 식당 리스트 (Tab: List)
- **검색 및 필터**:
    - **Exclusive Filter**: 찜한 매장 / 리뷰 남긴 매장 / 리뷰 대기 매장 (택1).
    - **Price Filter**: 최소~최대 가격 범위 입력.
    - **기본 필터**: 식당명/태그/메뉴명 검색, 카테고리 멀티 선택.
- **정렬 (Sorting)**:
    - **Desktop**: 테이블 헤더 클릭 시 정렬 토글 (이름, 카테고리, 가격, 평점, 리뷰, 좋아요).
    - **Mobile**: 드롭다운 선택(기준) + 토글 버튼(오름/내림차순) 조합.
- **UI 표시**:
    - **Desktop (Grid)**: 평균 가격, 평점, 리뷰수 등 전체 컬럼 표시.
    - **Mobile (Card)**: 카드 우측 상단에 평균 가격 표시. 좋아요 클릭 시 하트 파티클 애니메이션.

### 4.3. 식당 상세/추가/수정 (Modal)
- **뷰 모드 (View)**:
    - **메뉴 정렬**: `is_signature=true`인 메뉴를 **리스트 최상단**에 배치하여 강조. 그 아래 일반 메뉴 나열.
    - 리뷰 작성 및 리스트 확인.
- **수정 모드 (Edit)**:
    - **메뉴 관리**:
        - 동적 리스트 (추가/삭제).
        - **시그니처 설정**: 메뉴명 좌측 **[★] 버튼**으로 토글.
    - **입력 제어**: 가격 필드는 숫자만 입력 가능 (`inputmode="numeric"`), 0원 허용, 음수 불가.
    - **저장 로직**: 전체 메뉴 리스트 전송 → 서버 Overwrite → 평균가 및 대표메뉴명 추출 후 식당 정보 갱신.

### 4.4. 랜덤 뽑기 (Tab: Wheel)
- **룰렛**: 필터링된 식당 리스트를 대상으로 랜덤 추첨.
- **툴팁**: 식당 호버 시 평균 가격 및 상세 정보 노출.

### 4.5. 마이페이지 (Tab: MyPage)
- **구조**: 좌측 사이드바(PC) / 상단 탭(Mobile).
- **탭 구성**:
    1.  **내 정보**: 프로필 요약 및 다음 등급 진행도.
    2.  **찜 리스트**: 내가 좋아요한 식당 카드 리스트.
    3.  **나의 리뷰**: 내가 작성한 리뷰 식당 카드 리스트.